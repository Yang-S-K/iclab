#!/usr/bin/env python3
#coding=utf-8
import sys
import rospy
import numpy as np
import math
from Python_API import Sendmessage

#--Ê†°Ê≠£Èáè--#
#ÂâçÈÄ≤ÈáèÊ†°Ê≠£
FORWARD_CORRECTION         = -300
#Âπ≥ÁßªÊ†°Ê≠£
TRANSLATION_CORRECTION     = 0
#ÊóãËΩâÊ†°Ê≠£
THETA_CORRECTION           = 0
#Âü∫Á§éËÆäÂåñÈáè(ÂâçÈÄ≤&Âπ≥Áßª)
BASE_CHANGE                = 200      

# ---ÂæÆË™øÁ´ôÂßøÈñãÈóú---#
STAND_CORRECT_CW           = False                 #sector(33) CW_standÂæÆË™øÁ´ôÂßø
DRAW_FUNCTION_FLAG         = False                  #ÂΩ±ÂÉèÁπ™ÂúñÈñãÈóú
TARGET_COLOAR              = 'Blue'                 #'Orange' 'Yellow' 'Blue' 'Green' 'Black' 'Red' 'White'    

#------------------#
HEAD_HORIZONTAL            = 2048                  #È†≠Ê∞¥Âπ≥
HEAD_VERTICAL              = 1400                  #È†≠ÂûÇÁõ¥ #down 2750

#Âà§Êñ∑ÂÄº
FOOTLADDER_LINE            = 215                   #‰∏äÊ¢ØÂü∫Ê∫ñÁ∑ö

FIRST_FORWORD_CHANGE_LINE  = 120                    #Â∞èÂâçÈÄ≤Âà§Êñ∑Á∑ö
SECOND_FORWORD_CHANGE_LINE = 130                    #ÂâçÈÄ≤Âà§Êñ∑Á∑ö
THIRD_FORWORD_CHANGE_LINE  = 150                   #Â§ßÂâçÈÄ≤Âà§Êñ∑Á∑ö
UP_LADDER_DISTANCE         = 63                    #ÊúÄ‰Ωé‰∏äÊùøÈúÄÊ±ÇË∑ùÈõ¢

#ÂâçÂæåÂÄº
BACK_MIN                   = -300                  #Â∞èÈÄÄÂæå
FORWARD_MIN                = 300                  #Â∞èÂâçÈÄ≤
FORWARD_NORMAL             = 800                  #ÂâçÈÄ≤
FORWARD_BIG                = 1000                  #Â§ßÂâçÈÄ≤

#Âπ≥ÁßªÂÄº
TRANSLATION_BIG            = 800                  #Â§ßÂπ≥Áßª
TRANSLATION_NORMAL         = 400
#ÊóãËΩâÂÄº
THETA_MIN                  = 3                     #Â∞èÊóãËΩâ
THETA_NORMAL               = 1                    #ÊóãËΩâ
THETA_BIG                  = 5                     #Â§ßÊóãËΩâ

#Â∑¶Âü∫Á§éÂèÉÊï∏
LEFT_THETA                 = 1
#Âè≥Âü∫Á§éÂèÉÊï∏
RIGHT_THETA                = -1

BLUE_MID = 260
BLUE_ERROR = 2


send       = Sendmessage()
class WallClimbing:
#CW‰∏ªÁ≠ñÁï•
    def __init__(self):
        # self.ladder = ObjectInfo(LADDER_COLOAR,'Ladder')

        color_dict = {  'Orange':  0,
                        'Yellow':  1,
                        'Blue'  :  2,
                        'Green' :  3,
                        'Black' :  4,
                        'Red'   :  5,
                        'White' :  6 }
        self.color = color_dict[TARGET_COLOAR]
        self.init()
        self.STAND_CORRECT_CW = STAND_CORRECT_CW
        self.blue_x_middle = 0
        
    def main(self,strategy):
        send.sendHeadMotor(1, self.head_Horizontal, 100)#Ê∞¥Âπ≥
        send.sendHeadMotor(2, self.head_Vertical, 100)#ÂûÇÁõ¥
        if DRAW_FUNCTION_FLAG:
            self.draw_function()
        sys.stdout.write("\033[J")
        sys.stdout.write("\033[H")
        rospy.loginfo('________________________________________\033[K')
        rospy.loginfo(f'x: {self.now_forward} ,y: {self.now_translation} ,theta: {self.now_theta}\033[K')
        rospy.loginfo(f'Goal_x: {self.forward} ,Goal_y: {self.translation} ,Goal_theta: {self.theta}\033[K')
        rospy.loginfo(f"Ê©üÂô®‰∫∫ÁãÄÊÖã: {self.state}\033[K")
        rospy.loginfo(f"Ë∑ùÈõ¢Ê¢Ø: {(FOOTLADDER_LINE - self.lower_blue_ymax)}\033[K")
        rospy.loginfo(f"ËóçËâ≤‰∏≠ÂøÉ: { (send.color_mask_subject_XMin[self.color][0]+send.color_mask_subject_XMax[self.color][0])/2}\033[K")
        rospy.loginfo(f"blue_x_middle: { self.blue_x_middle}\033[K")
        rospy.loginfo('Ôø£Ôø£Ôø£Ôø£Ôø£Ôø£Ôø£Ôø£Ôø£Ôø£Ôø£Ôø£Ôø£Ôø£Ôø£Ôø£Ôø£Ôø£Ôø£Ôø£Ôø£Ôø£')
        
        if strategy == "Wall_Climb_off":
        #ÈóúÈñâÁ≠ñÁï•,ÂàùÂßãÂåñË®≠ÂÆö
            if not self.walkinggait_stop:
                rospy.loginfo("üîäCW parameter reset\033[K")
                send.sendHeadMotor(1,self.head_Horizontal,100)  #Ê∞¥Âπ≥
                send.sendHeadMotor(2,self.head_Vertical,100)    #ÂûÇÁõ¥
                send.sendBodyAuto(0,0,0,0,1,0)
                send.sendSensorReset(1,1,1)              #IMUreset
                rospy.sleep(2)
                send.sendBodySector(29)             #Âü∫Á§éÁ´ôÂßøÁ£ÅÂçÄ
                rospy.sleep(1.5)
                # if STAND_CORRECT_CW:
                #     send.sendBodySector(30)             #CWÂü∫Á§éÁ´ôÂßøË™øÊï¥Á£ÅÂçÄ
                #     STAND_CORRECT_CW = False 
                rospy.loginfo("resetüÜóüÜóüÜó\033[K")
                self.imu_reset = True
            self.init()
            self.find_ladder()
            rospy.loginfo("turn off\033[K")
            self.walkinggait_stop = True

        elif strategy == "Wall_Climb_on":
            send.sendWalkParameter('send',\
                        walk_mode = 1,\
                        com_y_shift = -1.5,\
                        y_swing = 4.5,\
                        period_t = 270,\
                        t_dsp = 0.1,\
                        base_default_z = 1.2,\
                        com_height = 29.5,\
                        stand_height = 23.5)
        #ÈñãÂïüCWÁ≠ñÁï• 
            if self.state != 'cw_finish':
                if self.STAND_CORRECT_CW:
                    send.sendBodySector(102)             #CWÂü∫Á§éÁ´ôÂßøË™øÊï¥Á£ÅÂçÄ
                    while not send.execute:
                        rospy.logdebug("Á´ôÁ´ãÂßøÂã¢\033[K")
                    send.execute = False
                    self.STAND_CORRECT_CW = False
                    rospy.sleep(2)
                if self.imu_reset:

                    send.sendSensorReset(1,1,1)
                    send.sendBodyAuto(0,0,0,0,1,0)
                    self.imu_reset = False

                rospy.loginfo(f"blue ymax: {self.lower_blue_ymax}\033[K")
                self.find_ladder()
                self.walkinggait(motion=self.edge_judge(strategy))
            self.walkinggait_stop = False
                    
    def init(self):
        #ÁãÄÊÖã
        self.state                 = 'ÂÅúÊ≠¢'
        
        #Ê≠•ÊÖãÂïüÂãïÊóóÊ®ô
        self.walkinggait_stop      = True  
        
        #Ë®≠ÂÆöÈ†≠ÈÉ®È¶¨ÈÅî
        self.head_Horizontal       = HEAD_HORIZONTAL
        self.head_Vertical         = HEAD_VERTICAL
        
        #imu_reast
        self.imu_reset             = True

        #Ê≠•ÊÖãÂèÉÊï∏
        self.forward               = FORWARD_NORMAL + FORWARD_CORRECTION
        self.translation           = 0              + TRANSLATION_CORRECTION
        self.theta                 = 0              + THETA_CORRECTION
        self.now_forward           = 0 
        self.now_translation       = 0
        self.now_theta             = 0

        self.new_target_xmin       = 0
        self.new_target_xmax       = 0  
        self.lower_blue_ymax       = 0

    def find_ladder(self):
    #Áç≤ÂèñÊ¢ØÂ≠êË≥áË®ä„ÄÅË∑ùÈõ¢Ë≥áË®ä
        self.lower_blue_ymax      = 0
        self.new_target_xmax = 0
        self.new_target_xmin = 0
        self.new_target_ymax = 0
        self.blue_x_middle = 160
        rospy.loginfo(f"blue mask subject cnts: {send.color_mask_subject_cnts[self.color]}\033[K")
        sys.stdout.write("\033[K")
        #-------Ë∑ùÈõ¢Âà§Êñ∑-------#
        for blue_cnt in range (send.color_mask_subject_cnts[self.color]):
            
            if send.color_mask_subject_size[self.color][blue_cnt] > 10:
                self.new_target_xmax = send.color_mask_subject_XMax[self.color][blue_cnt]
                self.new_target_xmin = send.color_mask_subject_XMin[self.color][blue_cnt]
                self.new_target_ymax = send.color_mask_subject_YMax[self.color][blue_cnt]
                
                if self.lower_blue_ymax < self.new_target_ymax:
                    self.lower_blue_ymax = self.new_target_ymax
                    self.blue_x_middle = (self.new_target_xmax + self.new_target_xmin) / 2
                    rospy.logwarn(f"lower blue ymax: {self.lower_blue_ymax}\033[K")
    
    def walkinggait(self,motion):
    #Ê≠•ÊÖãÂáΩÊï∏
        if motion == 'ready_to_cw':
            rospy.loginfo("Â∞çÊ≠£Ê¢ØÂ≠ê\033[K")
            send.sendBodyAuto(0,0,0,0,1,0)           #ÂÅúÊ≠¢Ê≠•ÊÖã
            send.sendSensorReset(1,1,1)                   #IMU reset ÈÅøÂÖçÊ©üÂô®‰∫∫Ê≠•ÊÖã‰øÆÊ≠£ÈåØË™§
            rospy.sleep(3)                           #Á©©ÂÆöÂÅúÊ≠¢ÂæåÁöÑÊêñÊôÉ
            send.sendBodySector(29)                  #ÈÄôÊòØÂü∫Êú¨Á´ôÂßøÁöÑÁ£ÅÂçÄ
            while not send.execute:
                rospy.logdebug("Á´ôÁ´ãÂßøÂã¢\033[K")
            send.execute = False
            rospy.sleep(3) 
            #-Áà¨Ê¢ØÁ£ÅÂçÄ-#
            send.sendBodySector(871)         
            rospy.sleep(10)
            send.sendBodySector(872)
            rospy.sleep(12)
            #---------#
            self.status = 'cw_finish'

        else:
            #ÂâçÈÄ≤ËÆäÂåñÈáè
            if self.now_forward > self.forward:
                self.now_forward -= BASE_CHANGE
            elif self.now_forward < self.forward:
                self.now_forward += BASE_CHANGE
            else:
                self.now_forward = self.forward

            #Âπ≥ÁßªËÆäÂåñÈáè
            if self.now_translation > self.translation:
                self.now_translation -= BASE_CHANGE
            elif self.now_translation < self.translation:
                self.now_translation += BASE_CHANGE
            else:
                self.now_translation = self.translation

            #ÊóãËΩâËÆäÂåñÈáè
            # if send.imu_value_Yaw > 1:
            #     self.now_theta = -THETA_NORMAL
            # elif send.imu_value_Yaw < -1:
            #     self.now_theta = THETA_NORMAL
            # else:
            #     self.now_theta = 0
            self.now_theta = self.imu_angle()
            #ÈÄüÂ∫¶Ë™øÊï¥
            send.sendContinuousValue(self.now_forward, self.now_translation, 0, self.now_theta, 0)

    def edge_judge(self,strategy):
    #ÈÇäÁ∑£Âà§Êñ∑,ÂõûÂÇ≥Ê©üÂô®‰∫∫Ëµ∞Ë∑ØÈÄüÂ∫¶ËàáËµ∞Ë∑ØÊ®°Âºè
        if (self.lower_blue_ymax >= FOOTLADDER_LINE - UP_LADDER_DISTANCE) and (self.blue_x_middle >= BLUE_MID-BLUE_ERROR) and (self.blue_x_middle <= BLUE_MID+BLUE_ERROR) and abs(send.imu_value_Yaw) < 1.2:
            self.state = "Áà¨Ê¢Ø"
            return "ready_to_cw"
        
        else:
            if (self.lower_blue_ymax > FOOTLADDER_LINE):
                self.theta       = send.imu_value_Yaw/4
                self.forward     = BACK_MIN + FORWARD_CORRECTION
                self.state       = "!!!Â∞èÂøÉÊé°Âà∞Ê¢ØÂ≠ê,ÂæåÈÄÄ!!!"

            elif (self.lower_blue_ymax >= FOOTLADDER_LINE - UP_LADDER_DISTANCE) and (self.blue_x_middle < BLUE_MID):
                self.forward     = BACK_MIN+ FORWARD_CORRECTION
                self.theta       =  0
                self.translation = LEFT_THETA * TRANSLATION_NORMAL + TRANSLATION_CORRECTION +100
                self.state       = "Â∑¶Âπ≥Áßª"

            elif (self.lower_blue_ymax >= FOOTLADDER_LINE - UP_LADDER_DISTANCE) and (self.blue_x_middle > BLUE_MID):
                self.forward     = BACK_MIN+ FORWARD_CORRECTION
                self.theta       =  0
                self.translation = RIGHT_THETA * TRANSLATION_NORMAL + TRANSLATION_CORRECTION
                self.state       = "Âè≥Âπ≥Áßª"
            
            else:
                if (FOOTLADDER_LINE - self.lower_blue_ymax) < FIRST_FORWORD_CHANGE_LINE:
                    if self.blue_x_middle < BLUE_MID-BLUE_ERROR: #Â∑¶Áßª
                        self.translation = LEFT_THETA * TRANSLATION_NORMAL + TRANSLATION_CORRECTION
                        self.state       = "Â∑¶Âπ≥Áßª  "
                    
                    elif self.blue_x_middle > BLUE_MID+BLUE_ERROR: #Âè≥Áßª
                        self.translation = RIGHT_THETA * TRANSLATION_NORMAL + TRANSLATION_CORRECTION
                        self.state       = "Âè≥Âπ≥Áßª  "
                    else:
                        self.translation = TRANSLATION_CORRECTION
                elif (FOOTLADDER_LINE - self.lower_blue_ymax) < SECOND_FORWORD_CHANGE_LINE:
                    if self.blue_x_middle < BLUE_MID-BLUE_ERROR: #Â∑¶Áßª
                        self.translation = LEFT_THETA * TRANSLATION_BIG+ TRANSLATION_CORRECTION
                        self.state       = "Â§ßÂ∑¶Âπ≥Áßª  "
                    
                    elif self.blue_x_middle > BLUE_MID+BLUE_ERROR: #Âè≥Áßª
                        self.translation = RIGHT_THETA * TRANSLATION_BIG + TRANSLATION_CORRECTION
                        self.state       = "Â§ßÂè≥Âπ≥Áßª  "
                    else:
                        self.translation = TRANSLATION_CORRECTION
                

                
                if (FOOTLADDER_LINE - self.lower_blue_ymax) < FIRST_FORWORD_CHANGE_LINE:
                    self.forward     = FORWARD_MIN + FORWARD_CORRECTION
                    self.state      = 'Â∞èÂâçÈÄ≤'
                elif (FOOTLADDER_LINE - self.lower_blue_ymax) < SECOND_FORWORD_CHANGE_LINE:
                    self.forward     = FORWARD_NORMAL + FORWARD_CORRECTION
                    self.state      += 'ÂâçÈÄ≤'
                elif (FOOTLADDER_LINE - self.lower_blue_ymax) < THIRD_FORWORD_CHANGE_LINE:
                    self.forward     = FORWARD_BIG + FORWARD_CORRECTION
                    self.state      = 'Â§ßÂâçÈÄ≤'
                
                else:
                    self.theta      = THETA_CORRECTION
                    self.forward    = FORWARD_BIG + FORWARD_CORRECTION
                    self.state     = 'no'
            return 'walking'

    def draw_function(self):
    #Áï´Èù¢È°ØÁ§∫Áπ™Áï´Ë≥áË®ä    
        send.drawImageFunction(1, 0, 0, 320, FOOTLADDER_LINE, FOOTLADDER_LINE, 255, 0, 0)   #Âü∫Ê∫ñÁ∑ö
        send.drawImageFunction(2, 0, self.blue_x_middle, self.blue_x_middle, 0,240, 255, 255, 0) #Áâ©‰ª∂‰∏≠ÂøÉ
    
    def imu_angle(self):      #‰∏ÄËà¨ imu‰øÆÊ≠£ËßíÂ∫¶
        imu_ranges = [  (180,  -3),
                        (90,  -3), 
                        (60,  -3), 
                        (45,  -3), 
                        (20,  -3), 
                        (10,  -2), 
                        (5,   -2), 
                        (2,   -1), 
                        (0,    0),
                        (-2,    1),
                        (-5,    2),
                        (-10,   2),
                        (-20,   3),
                        (-45,   3),
                        (-60,   3),
                        (-90,   3),
                        (-180,   3)]
        for imu_range in imu_ranges:           
            if self.imu_yaw >= imu_range[0]:
                return imu_range[1]
        return 0

# ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñÑ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñÑ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë  ‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚ñÄ‚ñà‚ñà‚ñà‚ñà‚ñÄ‚ñÑ‚ñÑ‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚ñÑ‚ñà 
# ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñå‚ñí‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñÑ‚ñÄ‚ñí‚ñå‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë  ‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚ñà‚ñÄ‚ñë‚ñë‚ñë‚ñë‚ñÄ‚ñÄ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚†Ç‚†Ç‚†Ç‚†Ç‚ñÑ‚ñÑ‚ñÄ‚ñÄ‚ñà‚†Ç‚†Ç
# ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñå‚ñí‚ñí‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñÑ‚ñÄ‚ñí‚ñí‚ñí‚ñê‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë   ‚†Ç‚†Ç‚†Ç‚ñÑ‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÑ‚ñë‚ñë‚ñÑ‚ñÄ ‚†Ç‚†Ç
# ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñê‚ñÑ‚ñÄ‚ñí‚ñí‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÑ‚ñÑ‚ñÑ‚ñÄ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñê‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë  ‚†Ç‚ñÑ‚ñÄ‚ñë‚ñÄ‚ñÑ‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚ñÄ‚ñÑ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñÄ‚ñÑ‚ñÄ‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç
# ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñÑ‚ñÑ‚ñÄ‚ñí‚ñë‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñà‚ñí‚ñí‚ñÑ‚ñà‚ñí‚ñê‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë   ‚ñÑ‚ñÄ‚ñë‚ñë‚ñë‚ñë‚ñà‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚ñà‚ñÄ‚ñë‚ñë‚ñë‚ñÑ‚ñà‚ñÄ‚ñÑ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñÑ‚ñà‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç
# ‚ñë‚ñë‚ñë‚ñÑ‚ñÄ‚ñí‚ñí‚ñí‚ñë‚ñë‚ñë‚ñí‚ñí‚ñí‚ñë‚ñë‚ñë‚ñí‚ñí‚ñí‚ñÄ‚ñà‚ñà‚ñÄ‚ñí‚ñå‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë   ‚ñÄ‚ñÑ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñÄ‚ñÑ‚†Ç‚†Ç‚†Ç‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñÄ‚ñà‚ñà‚ñÄ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñà‚ñà‚ñÑ‚ñà ‚†Ç‚†Ç‚†Ç‚†Ç
# ‚ñë‚ñë‚ñê‚ñí‚ñí‚ñí‚ñÑ‚ñÑ‚ñí‚ñí‚ñí‚ñí‚ñë‚ñë‚ñë‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñÄ‚ñÑ‚ñí‚ñí‚ñå‚ñë‚ñë‚ñë‚ñë‚ñë  ‚†Ç‚†Ç‚ñÄ‚ñÑ‚ñë‚ñë‚ñë‚ñë‚ñÑ‚ñÄ‚†Ç‚ñà‚ñë‚ñë‚ñë‚ñÑ‚ñà‚ñà‚ñÑ‚ñë‚ñë‚ñë‚ñÑ‚ñë‚ñë‚ñÑ‚ñë‚ñë‚ñÄ‚ñÄ‚ñë‚ñà ‚†Ç‚†Ç‚†Ç‚†Ç
# ‚ñë‚ñë‚ñå‚ñë‚ñë‚ñå‚ñà‚ñÄ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñÑ‚ñÄ‚ñà‚ñÑ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñà‚ñí‚ñê‚ñë‚ñë‚ñë‚ñë‚ñë  ‚†Ç‚†Ç‚†Ç‚ñà‚ñë‚ñë‚ñÑ‚ñÄ‚†Ç‚†Ç‚ñà‚ñë‚ñë‚ñë‚ñë‚ñÄ‚ñà‚ñà‚ñÄ‚ñë‚ñë‚ñë‚ñë‚ñÄ‚ñÄ‚ñë‚ñÄ‚ñÄ‚ñë‚ñë‚ñÑ‚ñÄ‚†Ç‚†Ç‚†Ç‚†Ç
# ‚ñë‚ñê‚ñë‚ñë‚ñë‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñå‚ñà‚ñà‚ñÄ‚ñí‚ñí‚ñë‚ñë‚ñë‚ñí‚ñí‚ñí‚ñÄ‚ñÑ‚ñå‚ñë‚ñë‚ñë‚ñë  ‚†Ç‚†Ç‚ñà‚ñë‚ñë‚ñë‚ñà‚†Ç‚†Ç‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñÑ‚ñÑ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñÑ‚ñÄ‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç
# ‚ñë‚ñå‚ñë‚ñí‚ñÑ‚ñà‚ñà‚ñÑ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñí‚ñí‚ñí‚ñí‚ñå‚ñë‚ñë‚ñë‚ñë  ‚†Ç‚ñà‚ñë‚ñë‚ñë‚ñà‚†Ç‚†Ç‚ñà‚ñÑ‚ñÑ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñÄ‚ñÄ‚ñÑ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñÑ‚ñë‚ñà ‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç
# ‚ñÄ‚ñí‚ñÄ‚ñê‚ñÑ‚ñà‚ñÑ‚ñà‚ñå‚ñÑ‚ñë‚ñÄ‚ñí‚ñí‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñí‚ñí‚ñí‚ñê‚ñë‚ñë‚ñë‚ñë  ‚†Ç‚†Ç‚ñÄ‚ñÑ‚ñë‚ñÑ‚ñà‚ñÑ‚ñà‚ñÄ‚ñà‚ñà‚ñÑ‚ñë‚ñë‚ñÑ‚ñÑ‚ñë‚ñë‚ñë‚ñÑ‚ñÄ‚ñë‚ñë‚ñÑ‚ñÄ‚ñÄ‚ñë‚ñë‚ñë‚ñà ‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç
# ‚ñê‚ñí‚ñí‚ñê‚ñÄ‚ñê‚ñÄ‚ñí‚ñë‚ñÑ‚ñÑ‚ñí‚ñÑ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñë‚ñí‚ñë‚ñí‚ñë‚ñí‚ñí‚ñí‚ñí‚ñå‚ñë‚ñë‚ñë  ‚†Ç‚†Ç‚†Ç‚†Ç‚ñÄ‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñÄ‚ñÄ‚ñÄ‚ñë‚ñë‚ñë‚ñë‚ñÄ‚ñÑ‚ñë‚ñë‚ñë‚ñÑ‚ñÄ‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç
# ‚ñê‚ñí‚ñí‚ñí‚ñÄ‚ñÄ‚ñÑ‚ñÑ‚ñí‚ñí‚ñí‚ñÑ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñë‚ñí‚ñë‚ñí‚ñë‚ñí‚ñí‚ñê‚ñë‚ñë‚ñë‚ñë  ‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚ñÄ‚ñÄ‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñÑ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñÑ‚ñÄ‚ñà‚ñÄ ‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç
# ‚ñë‚ñå‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñÄ‚ñÄ‚ñÄ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñë‚ñí‚ñë‚ñí‚ñë‚ñí‚ñë‚ñí‚ñí‚ñí‚ñå‚ñë‚ñë‚ñë‚ñë  ‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚ñÄ‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñÑ‚ñÑ‚ñÑ‚ñÄ‚ñë‚ñë‚ñÑ‚ñÑ‚ñÄ‚ñÄ‚ñë‚ñÑ‚ñÄ ‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç
# ‚ñë‚ñê‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñë‚ñí‚ñë‚ñí‚ñë‚ñí‚ñí‚ñÑ‚ñí‚ñí‚ñê‚ñë‚ñë‚ñë‚ñë‚ñë  ‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç‚ñÄ‚ñÄ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÄ‚†Ç‚ñÄ‚ñÄ‚ñÄ‚†Ç‚ñÄ‚ñÄ‚ñÑ‚ñÑ‚ñÑ‚ñÄ‚†Ç‚†Ç‚†Ç‚†Ç‚†Ç
# ‚ñë‚ñë‚ñÄ‚ñÑ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñë‚ñí‚ñë‚ñí‚ñë‚ñí‚ñÑ‚ñí‚ñí‚ñí‚ñí‚ñå‚ñë‚ñë‚ñë‚ñë‚ñë
# ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
# +++++++++++++++++++++++++++++++++++++++++++++==--::::--==+++++++++++++++++++++++++++++++++++++++++++
# +++++++++++++++++++++++++++++++++++++++++++=-...........:-=+++++++++++++++++++++++++++++++++++++++++
# ++++++++++++++++++++++++++++++++++++++++++=:..............:=++++++++++++++++++++++++++++++++++++++++
# ++++++++++++++++++++++++++++++++++++++++++-......:--:......-++++++++++++++++++++++++++++++++++++++++
# +++++++++++++++++++++++++++++++++++++++++=......:++++:.....:++++++++++++++++++++++++++++++++++++++++
# +++++++++++++++++++++++++++++++++++++++++===----=++=-......-++++++++++++++++++++++++++++++++++++++++
# ++++++++++++++++++++++++++++++++++++++++++++++++++-:......:=++++++++++++++++++++++++++++++++++++++++
# ++++++++++++++++++++++++++++++++++++++++++++++++=:......:-++++++++++++++++++++++++++++++++++++++++++
# +++++++++*%@@%*++++++++++++++++++++++++++++++++=.......-=+++++++++++++++++++++++++++++++++++++++++++
# ++++++++*@#+**%@#++++++++++++++++++++++++++++++:.....:=+++++++++++++++++++++++++++++++++++++++++++++
# ++++++++@*+==++*#@%*+++++++++++++++++++++++++++::::::-++++++++++++++++++++++++++++++++++++++++++++++
# +++++++#%------+++#@%++++++++++++++++++++++++++=======++++++++++++++++++++++++++++++++++++++++++++++
# +++++++@*-------=+++#@#++++++++++++++++++++++++......-++++++++++++++++++++++++++++++++++++++++++++++
# +++++++@=---------+++*%@#++++++++++++++++++++++......-++++++++++++++++++++++++++++++++++++++++++++++
# ++++++*@-----------=+++*%%*++++++++++++++++++++......-++++++++++++++++++++++++++++++++++++++++++++++
# ++++++*@--------=*%%#*+++*%%*++++++++++++++++++------=+++++++++++++++++++++++++++++++**#%#++++++++++
# ++++++*@--+%%##%%*-:=#@#*++#@%++++++++++++++++++++++++++++++++++++++++++++++++++++*%@%#**@*+++++++++
# +++++++@+**+=-.  .:-.  -+*++*#@%+++++++++++++++++++++++++++++++++++++++++++++++*%@%*+++++%%+++++++++
# +++++++@%+----:.          .:+++#%#++*##########*++++++++++++++++++++++++++++*#@%#+++++===%%+++++++++
# +++++++-..                 .+++++*#####*****####%%@%##*++++++++++++++++++*#%%#*++++=-----%#+++++++++
# +++++=*%%*=.      .-=+***++++++++++++++++++++++++++**#%%%%*+++++++++++*#@%#*+++==-------=@++++++++++
# ++++#@+.      -+#%%#*+++++++++++++++++++++++++++++++++++**#%%#*++++*%@%#*+++=-----------%%++++++++++
# +++%%==-  .=#%%#*+++++++++++++++++++++++++++++++++++++++++++**#%%%%#*++++++****+=------+@+++++++++++
# +++##%=.=#@#*++++++++++++++++++++++++++++++++++++++++++++++++++*****+--=++++======----=@#+++++++++++
# +++@#-*%#*+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++=:.      :--:.:--%%++++=+++++++
# +++@@%#*+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-.    .-*%%**#+=+++=+++++++
# +#@%*+++++++++++++++-:-++++++++++++++++++++++++++++++++++++++++++++++++++++=:      :+%%*+-+++-++++++
# %%*++++++++++++++=: .=++++++++++++++*%*+++++++++++++++++++++++++++++++++++++++=.   .  -%#+-++*-***++
# *++++++++++++++-.  -**++++++++++++*#@@*+++++++++++++++++++++++++++++++++++++++**=  .+#-:#++=*++=***+
# +++++++++++++:   .*#+++++++++++++#@*+@++++++++++++++++++++++++++++++++++++++++++##:  -%#+++-+++=+**+
# +++++++++++-    -%*++++++++++++#@*: +%++++++++++++++++++++++++*%*++++++++++++++++*%+  =%@++=:*=***+*
# ++++++++++:    *@*++++++++++*#@*:   +@++++++++++++++++++++++++#@%+++++++++++++++++*%#.=@%*+-+++=*+++
# +++++++++:   .#%*++++++++*#%%+.     -@*+++++++++++++++++++++++%*%%++++++++++++++++++%%.*%+*-*+++*+++
# ++++++++:   .%%+++++++*#%%*-         #%++++++++++++++++++++++*@::@#+++++++**+++++++++%%:%#*--+++++++
# +++++++:   .#%++++*##%%+-.           :@#++*++++++++++++++++++%+  -@#++++++*%#+++++++++%%*%+++++*++++
# ++++++-    #%*##%@@%%*===--..         =@#+*+++++++++++++++++#%.   -@#++++++*@#+++++++++%@*++++++++++
# +++++=    +@##@@@@@@@@@@@@@@@%*=-.     =@#*#+++++++++++++++*@-     -@#++++++#@*++++++++*%%++++++++++
# +++++.   -@-.++#%#*+======+*#%@@@@%+-.  -%%*#++**+++++++++*@=       :%%*+++++#@*++++++++*@#+++++++++
# ++++-   .%*       :=*#%%%%%%%#+==+#@@@*- .+%*=-#%@@%####*#@+         .+@#*++++%%+++++++++#@+++++++++
# ++++.   +@.    :*%%#*+=======+*#@*- :=+*=.  :.   ..=+++*##+==++****+==::*@%#*+*@#+++++++++%%++++++++
# +++-   .%*   .*@*+===============*%#:                   =@@@@@@@@@@@@@@@%#%@@%#%@+++++++++*@#+++++++
# +++:   =@:  .%%+===================*%=                  .:::::::--=+=+*#@@@@@%#*@#+++++++++#@+++++++
# +++    #%   +@+=====================+%=                   .:+#@@%%%%%%*=:.-=*%@@@%+++++++++*@#++++++
# ++=    @+   +@+======================#%:                :*@%#*+=======+*%%*:  :=#@#+++++++++#%++++++
# ++-   .@-   .%#======================*@:               =@#+==============+*%#:  .@%*++++++++*@*+++++
# ++:   =@:    :@*=====================%%.              =@#===================*@-  #%++++++++++%#+++++
# ++:   =@.     -%#+=================+%%:              .@%=====================#@. +%++++++++++%%+++++
# ++-   =%       .+%#*=============+#@+.               :@#======================@= +%++++++++++#@+++++
# ++=   +%         .-*%%##*+++**#%@#=.                  %@+=====================@= +%++++++++++#@+++++
# **+   +%             .:=++***+=-.                     -%%====================*@: +%++++++++++*@+++++
# **+:  =@.                                              .*%*+===============+#@=  +%++++++++++#@+++++
# +%*=  :@:                                                :+%%#++========+*%@*:   *%++++++++++#@+++++
# +*@*-  %+                                 .-*#+             :=*%%%%##%%@%*-.     %#++++++++++%%+++++
# ++#%*. *@#=.                            =#@#=-%#:                .:-::..        .@#++++++**+*@*+++++
# +++%@+ .@%%@#=:                         .:.   .+%#.                             =@*++++++#%+#@++++++
# %*++#@+.=@**%@@%+-.                             .:.                             #%++++++*@#*@#++++++
# #%@%##%%+*%%+*%##%@%+-:                                                        :@#++++++%@+%%+++++++
# ++*##%##%@%+:%+#%**##@@%#*=-.                                                 :*%++++++#@*#@++++++++
# ++++++*%#.:--@:.#@#**#@#:-=*#%#*+=-:.                                  .:-=+#%@@*+++++#@#*@@*+++++++
# +++++*@*.   =@.  +@%***%@=    .:-=+*#%%#**+===--::::::::::---===++**#%%%%%##**%%+++++#@#*%*%%+++++++
# ++++*@+     +#    :%%#**#@%-           .:%#=+@#****#####**#@@@%@%+%#*++++++++#%*+++*%%*+*++#@+++++++
# +++*@#      #*     .%@#***%@+            -@*#@.         -#@@%#*#@:=@#++++++++%*+++*@%++++++#@+++++++                                                                  
#                                                           ...                                                                      
#      =+=:        .-==.                              .-=++++++++++++++=+=-:                                                          
#     -=.:=++    ++=-:-+                           :=++==++***++*+++++*++++*#*-:                                                      
#     #.::-.#    #.-::.#.                       .=+==+*+++***++++++++##++++*+*%##+:                                                   
#    :+::::+-    -=::::=-                   =+:++-+*++++++*=#+++++++#=#+++*##*****##+..                                               
#    *::::.#     .#.-:-:*                   -#*+++++******-+#++****#-=#++##**#*******#**:                                             
#    #.:::==      +:-:-.#.                 .*+=+****=----+=+*#+=---=-+####*##**#**#**#=+-                                             
#   .*.:::+*+-    -=:--:+:        .%*=-.  -%=*#-=+=-=+*####*+--+*****##***#*##*****#**+*-                                             
#   :*:--.=.:=*=  .*:--:==         :*=*#*#+-=*++==+#*+====--=*#==++**+#****##**#****#**-#.                                            
#   :*:--:.---.#. .#.---:+          :#-=#++*+-=-**++**+*-=#*++**++-**##*#***#*#*#****#*-%%.                                           
#   :*:--:---:==   #.---:*           =*--==-=+**+++++++*=+*+++++*#-#++#***#**#*********=++#-:                                         
#   .#.------:*    #.---.#           +#+---+-#*+++++++++#*++++++*-**++*###*****#***#***==-==*+                                        
#    *:-----:#.    =+===++          +#+*%#**+#+-+++++++++*++++++*-==*+#***##*#*****#**++..:-:-*:                                      
#    :*:---:*:      ....         :+##++%*+++%+*-*=  =++++++++++++=  -**:##***#*******=.::..:.--*-                                     
#     -*--=*:                 .+%#+=+*##=+++*+*-*.  :+:=+++=++++++  ..#-+*#****++++-*::.::.::::++                                     
#      .:-:++++=-:.            .-=**%-#=+++*++#=*   == -++*.-+++++ ....==+*####%**+== ::... :-:=#.                                    
#         *--:::-==++=              +=*-+++*+**=#::-*+++++++++*+++     --*++++++#==--:.:...:.-:+=#                                    
#        ==:-----==-.#.             #*+=+++#+*==#:*+*+++++++++*+++    .--**+++++*=+--:::.....==+#=                                    
#        .+++=----=:+-             .#+=++++#+*-=*:++*+++++++++*++=    ..-+#++++#==+=-=:::---=-*-                                      
#     .=+++=+==--:::-*-        .    #=-+++**+=:-*-=++*++++++++*++-     .=++*++++#*====*+==---##+                                      
#     +-::--=========.#     .=#+#*. =#-+++*++:.=+=-++#++++++++*+*:.   . ====++++**#*#=+++=++#*+*%:                                    
#     +:=============-+    .#-=.--+  %-+==++*--+*+=+=**====+++#+*==----:==+ *+++++*+*###%%##*#%=-.                                    
#     *:-:--=.:====-=+.   .%= - ::%+.%-+===+*. .*-=-==#====++=*=+       ==+.*+++++++++**%#****%.                                      
#     :*+*%=-=====:-+=    .#:.: -.==+#-+===++:::-*--*=*+====+=+*=::::-: ===:*+*++*++++**%*##**%                                       
#      :+=-=========.#.-=-.%..  .:.-+*-===###****%*#++=*====+%#%#*******#=-.*+++++++++*##*#*%%-                                       
#    .++-=====--:===:==-:+:%. :::-.:*+=-+-*-**=:::*=:+=++=-=-=*+#-::--#-++: ++++*++++**%**#+%-                                        
#    #:=====-++#:+===+++-*:+=  .:. .%+*-*=* +*.   =-. .=.:=++=+**     #.*+. =+++***++*##***+%                                         
#    -*-==-++. *-=+++++=:#.:%.  .-++=#%:=#=::*:   +:        .::-*     % ++  =+*+-::+**%***++%                                         
#     .++=*:  .:+*====+++=  ++-==.**=*@==##+ :*   #       .   . -+   =+:+-  =*-.--. #%#**+++%                                         
#       ..   -*==++...      +#- .=#%#=*%-##-..-+++:  .        .  -++*+.=*.. =-.=- . **#*++++%                                         
#            +:++:#       .*= .+%#=-%-.#***.....    .         .   .....*-   . -:--  #*#+++++%                                         
#            *.++.*      .#: -##-   :%:.#*=.....  .               ....-= .  . =--: +#**+++++%                                         
#            #:++.*      +-:+%=      -%:.%+         .              . .-   . . .= .*%*+*+++++%                                 .       
#           .*-++:*      .#+%:        -%--@-       ..+=====++             .=*=#**#*%*+++++++%                                 .       
#           :+=+*:*       :@-:         =%%##*-      .--:::--=           :==::-=#**+%*+++++++%                                         
#           -=++*:*        ==::         *%#**##+-.           ..     :=+++::-::=*++*#*++++*++%                                         
#           =-++*:*         +-:.       :####*##*##%*++==----====++#+==::-----:*=++##+++++*++%                                         
#           +-*+*:*        =.*-:.      -*%%**#**#*%*#*---=+#=-:--=+**--------:*+++##+++++*++%.                                        
#           +:*+*.*        *  *::.      -#%##%*+*+%*#=+*++*****+*++*----------++++*#+*+++*++%:                                        
#           *:***.*       :=  .#::.      =#%##*+*+#*#:**:.+=+=-*:=*--=++-=-+-+-++#+*+*++*#*+#-                                        
#           *:***:*       :+   .#::.      +%##+++*#*#=*=:.-*+%-=-....  .=%#%+#-++%+*+*++#**+*+                                        
#           *---==+       -+    .*:::    .+#%%=++#*#*##. ..++: ......    :#**#-++%##**++#**++#                                        
#       =++-.-=--:  :-==. :*     .*-::. :=**-*=++%*#=*+ . =.+ . ... . . . =%%%-++#*#%+++#*#++%:                                       
#      :*-==+*.   =+===:* .#  -.   ++::. +.= ===*-*+*#-.  :=.  .-:-::- . .:%%%++=#*##++*%*#+=**                                       
#      *:***-*.   +:***=+: #  =.    :*-::.*.+=+=* :*++***+===+++++++#=.   .%%%%+++%#%==##%#+==%.                                      
#     .*-***-+    :*=***-+ +: =:      #+.::+--=++.#++++++++++++++++++**=.. %%%%%%%%%#==#***##*+*                                      
#     =-***-*.     *:#*#:# :+ --      *+=:::+==#-#*++++++++++++++++++%*+*=.#%%%%%%%%+==%****%*=#:                                     
#     *:***:+      ==***=+: +..*      #-%::--===#%+++++++++++++++++++%:=***#*%%%%%%%===%%%#**##=#                                     
#     #:#**=*+=.   .*=***-= .= *.    .#:*+.=--+*:%*+++++++*+++++++++*%- .-+*%%%%%%%%===%%%%#**#**-                                    
#    .#-#*+--=-++.  #-#*#:*    .+    .*:*::=--#*+-%*++++++#+++++++++#@=  -*=%%%#%%%@=-=%%#*****#=#                                    
#    .#-***.**#=+:  #:#*#:#     -:   :+-+ ----%:=:*%##++++*#++++***#%%+:*#####****#%=-=%%#****#%+#:                                   
#     #-#******-+   *:###-#.     .   -=*: =:-=* :*-%#%%***+*#*%##%**#%##***********#=-=#****##%%==+                                   
#     #:#*#*##:#.   +:###=*.         =-#  =--+: ==:%++####**#***++*##**************#+--%****#%%%=-#                                   
#     =-*#*##-*:    -*==++*          **-  =-++ :-.##*+**###*+++++*+*%***************#--%***#%%%@-:#.                                  
#     .#-*##-*-       ...           -#*#.:=-*+ =  *##**++++++++++*#%#***************%--#***##%%#+-*-                                  
#      :*===*-                      *+####=-#=:- .%**+++++++++*#%#*#%***************#=:+#**%%++*#-+=                                  
#        :-:                       -*=%=..+-%=*  +#++++++*####*+++*%%#%**#***********#:=*#%**++*%-==                                  
#                                  #-##:  *-#-+ .%########+*####***%%%%####**********#=-=+:-*++#%=+=                                  
#                                 +##*    *:+++ +#+++++++%#+++++***%%%##**###++%#*%%+#*:-+::#+=%#=+-                                  
#                                 .#=.    =-+++.#+++++=+*+*#+++++++###**#*=.. ..+:**++-+::*.#=+++-*.